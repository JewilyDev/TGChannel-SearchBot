
## Основные модули

### 1. `embedder.py` - Генерация векторных представлений
**Назначение**: Преобразование текста в векторные эмбеддинги

**Функционал**:
- Использует модель `intfloat/multilingual-e5-small`
- Поддержка батчевой обработки текстов
- Нормализация векторов (L2)
- Разбиение текста на чанки:
  - По символам (`split_text`)
  - Семантическое через Natasha (`natasha_split`)

**Особенности**:
- Удаление эмоджи и специальных символов
- Лемматизация и морфологический анализ для русского языка
- Настраиваемый размер чанков

### 2. `index_build.py` - Построение поисковых индексов
**Назначение**: Создание и обновление поисковых индексов

**Ключевые функции**:
- `create_embeddings()` - генерация/получение эмбеддингов
- `clusterize_embeddings()` - кластеризация DBSCAN
- `create_bm25_index()` - построение текстового индекса
- `create_usearch_index()` - построение векторного индекса

**Особенности**:
- Поддержка инкрементального обновления
- Фильтрация по источникам и релизам
- Автоматическое определение репрезентативных документов
- Логирование процесса построения

### 3. `index_search.py` - Поиск по индексам
**Назначение**: Обработка поисковых запросов

**Основные компоненты**:
- Класс `Candidate` - унифицированное представление результата
- Класс `IndexQuery` - ядро поисковой системы:
  - Гибридный скоринг (BM25 + косинусная близость)
  - Поддержка фильтров по дате и источникам
  - Интеграция с ранкером
- Функция `index_search()` - точка входа для поиска

**Алгоритм работы**:
1. Векторизация запроса
2. Параллельный поиск по BM25 и векторному индексу
3. Гибридное ранжирование результатов
4. Фильтрация по дополнительным критериям
5. Финальное ранжирование cross-encoder

## Технологический стек

### Основные технологии
1. **Модели эмбеддингов**:
   - `transformers.AutoModel` (multilingual-e5-small)
   - PyTorch для инференса

2. **Поисковые системы**:
   - USearch - векторный поиск
   - BM25s - текстовый поиск

3. **Обработка текста**:
   - Natasha - морфологический анализ для русского языка
   - Регулярные выражения для очистки текста

4. **Дополнительные**:
   - DBSCAN для кластеризации
   - Cross-Encoder для реранкинга
   - AsyncIO для асинхронного выполнения

### Конфигурация
- Параметры индексов хранятся в `config_manager`
- Пути к файлам индексов настраиваются через конфиг
- Поддержка environment variables (`TOKENIZERS_PARALLELISM`)

## Особенности реализации

1. **Гибридный поиск**:
   - Комбинация векторного и текстового методов
   - Адаптивные веса в зависимости от длины запроса

2. **Кластеризация результатов**:
   - Автоматическое определение дубликатов
   - Выбор наиболее релевантных документов

3. **Поддержка фильтров**:
   - По источникам (каналам)
   - По дате публикации
   - Только релизы/все сообщения

4. **Оптимизации**:
   - Батчевая обработка запросов
   - Кэширование эмбеддингов
   - Асинхронный доступ к БД

## Пример использования

```python
# Построение индексов
await create_search_indicies_by_sources(
    create_bm25=True,
    create_usearch=True,
    sources=["channel1", "channel2"]
)

# Выполнение поиска
results = await index_search(
    query="новые технологии",
    topK=10,
    source="channel1",
    release_only=True
)